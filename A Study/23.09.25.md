#### The **Entity System** is the API for entity manipulation (CRUD: create, read, update, delete). Entity validation has its own API (which could validate an Entity saved via REST, rather than a form, for example).

## The Drupal 8 entity system

|Entities are typed classes with methods|
|---|---|
|Generic methods|`$entity->id()`|
|Entity type specific methods|`$node->getTitle()`|

Both types are defined and documented in _interfaces_.

## Configuration Entity and Content Entity

Entity types in core come in two variants.

Configuration Entity

Used by the Configuration System. Supports translations and can provide custom defaults for installations. Configuration entities are stored within the common `config` database table as rows.

Content Entity

Consist of configurable and base fields and can have revisions and support translations. Content entities are stored within a custom database table as rows. The table name is the same as the content entity "id", and the columns are defined by the entity's "baseFieldDefinitions" method.

### Bundles

Bundles are variants of an entity type. For example, with the node entity type, the bundles are the different node types, such as 'article' and 'page'.

Typically, a bundle is represented by a Configuration Entity, though other models exist in contrib modules. So in the node example, the 'article' node type is itself a configuration entity. The  configuration stores the differences between the content entity types, such as settings and fields. When creating a new entity type that has bundle entities, you will create both a Content Entity that will manage the content's details and operations, and a Configuration Entity that will handle the differences between the content entity types.

## Annotations

When creating a new entity type, you'll need to use the annotations system built into core. Annotations look like docblock comments above the class, but are parsed and cached by Drupal core. In a lot of ways annotations replace some of the older style hooks used in Drupal 7.

## Annotation parser

Annotations are read and parsed at runtime by an annotation engine. Drupal 8 uses the Doctrine annotation parser, which turns it into an object that PHP can use.

**Syntax** - The annotation syntax is surrounded with `@ClassName()`, is predominantly made up of key/value pairs, and can contain arrays that use curly braces. Top level keys must not be surrounded with quotation marks, while array keys must. Each key/value pair should be on their own line, and that line should end with a comma. Certain functions can be executed on values, notably the `@Translation()`function.

Non-working example of annotation syntax:

```php
/**
 * @ContentEntityType(
 *   id = "my_entity_type_id",
 *   label = @Translation("My entity type label"),
 *   example_pair = "this_examples_value",
 *   example_array = {
 *     "array_key" = "array_value",
 *     "some_other_key" = "some_other_value",
 *   },
 * )
 */
```

### Common top level annotations

|Key = "Example Value",|Description|Entity Variant|
|---|---|---|
|`id = "node",`|The machine name for the entity type.|Content & Config|
|`label = @Translation("Node"),`|The human-readable name for the entity type.|Content & Config|
|`admin_permission = "administer nodes",`|Permission that allows administrative access to configure and manage the entity type. This is necessary if your entity does not define an "access" handler.|Content & Config|
|`bundle_label = @Translation("Content type"),`|The optional human-readable name for the bundle entity type.|Content|
|`bundle_entity_type = "node_type",`|When creating a Content Entity that has bundles, this value should be the "id" of the Content Entity. In this case, "node_type" is a Content Entity.|Content|
|`base_table = "node",`|Database table name for the entity type.|Content|
|`field_ui_base_route = "entity.node_type.edit_form",`|The name of the route the Field UI is attached to on a fieldable entity.|Content|

### Handlers

Handlers are defined in the entity annotation as an array. They support the entity by mapping certain parts of its execution to other PHP classes. Those classes will "handle" the assigned parts of the entity's execution.

**Storage** - Handles the loading, saving and deleting of the entity. By default, Content Entities use `Drupal\Core\Entity\Sql\SqlContentEntityStorage` while Config Entities use `Drupal\Core\Config\Entity\ConfigEntityStorage`. You can define a storage handler to extend the default storage methods of your entity. You may want to do this to provide additional methods for gathering entity revision ids or determining the number of translations an entity has.  
Example: `"storage" = "Drupal\node\NodeStorage",`

**Form** - In any entity's handlers annotation there are multiple form handlers that map the entity's add, edit, and delete forms to other PHP classes.   
Example: 

```php
"form" = {
  "add" = "Drupal\block\BlockForm",
  "edit" = "Drupal\block\BlockForm",
  "delete" = "Drupal\block\Form\BlockDeleteForm",
​​​​​​​}
```

Alternatively, you can define a "default" form to handle both the "add" and "edit" form instead of defining them separately. Worth noting is that the "delete" form will almost always be handled by a separate class from the other forms. This is because the delete form is generally a "confirmation form" that simply asks if the user is sure they want to delete the entity.

**View builder** - This handler provides a class that will handle the output of the entity when viewed by the end user. For example, when visiting a node on a Drupal 8 site, entity's output is handled by the NodeViewBuilder class.  
Example: `"view_builder" = "Drupal\node\NodeViewBuilder",`

**List builder** - The list builder class will handle the list of entities for administrative purposes. This class will define the contents of the headers, rows, and operations when visiting the entities management page for the entity. For example, when visiting the /admin/content URI of your Drupal site, the table contents are provided by the Node entity's list builder class.  
Example: `"list_builder" = "Drupal\node\NodeListBuilder",`

**Route provider** - An optional handler that, if implemented, generates routes for your entity management. Implementing this handler can replace the need for entity routes defined in the routing.yml file of your module. Note, the route_provider works in conjunction with the Links defined on your entity (see example below Links section). The route_provider annotation is an array.  
Example: 

```php
"route_provider" = {
  "html" = "Drupal\Core\Entity\Routing\AdminHtmlRouteProvider",
}
```

**Access** - The access handler can be used to dynamically check permissions for your entity. It is a mapping to a class that implements the `EntityAccessControlHandlerInterface`. Core provides an implementation of this interface as `EntityAccessControlHandler`, but for reliable control over your entity you will want to extend that class with your own.  
Example: `"access" = "NodeAccessControlHandler",`

**Views data** - The views_data handler allows an entity to extend the Views module with custom data provided by your entity. This can be for adding your entity's baseFieldDefinitions as Views fields, joining tables on entity relationships, or other Views related data alterations.  
​​​​​​​Example: `"views_data" = "Drupal\node\NodeViewsData",`

**Storage schema** - The storage_schema handler can be implemented to further alter the entity's database storage settings. For instance, adding additional table indexes.  
Example: `"storage_schema" = "Drupal\node\NodeStorageSchema",` 

**Translation** - The translation handler can be used to alter the way in which your entity forms interact with translations.  
Example: `"translation" = "Drupal\node\NodeTranslationHandler",` 

#### Full handlers example:

Drupal core provides handlers that you can use out of the box, but in many cases you'll want to extend these classes with your own for greater control and customization of your entity. This example shows a more-complete handlers annotation, using the core classes you can extend.

```php
handlers = {
  "view_builder" = "Drupal\Core\Entity\EntityViewBuilder",
  "list_builder" = "Drupal\Core\Entity\EntityListBuilder",
  "access" = "Drupal\Core\Entity\EntityAccessControlHandler",
  "views_data" = "Drupal\views\EntityViewsData",
  "storage" = "Drupal\Core\Entity\Sql\SqlContentEntityStorage",
  "storage_schema" = "Drupal\Core\Entity\Sql\SqlContentEntityStorageSchema",
  "translation" = "Drupal\content_translation\ContentTranslationHandler",
  "form" = {
    "default" = "Drupal\Core\Entity\ContentEntityForm",
    "add" = "Drupal\Core\Entity\ContentEntityForm",
    "edit" = "Drupal\Core\Entity\ContentEntityForm",
    "delete" = "Drupal\Core\Entity\ContentEntityDeleteForm",
  },
  "route_provider" = {
    "html" = "Drupal\Core\Entity\Routing\AdminHtmlRouteProvider",
  },
},
```

### Links

Links are defined in the entity annotation with the array syntax. Links have a specific set of keys whose value are URIs where the entity type or single entities of that type can be managed. Both Content and Configuration Entities can have these links defined.

Example:

```php
id = "node",
handlers = {
  "route_provider" = {
    "html" = "Drupal\Core\Entity\Routing\AdminHtmlRouteProvider"
  }
},
links = {
  "canonical" = "/node/{node}",
  "add-page" = "/node/add",
  "add-form" = "/node/add/{node_type}",
  "edit-form" = "/node/{node}/edit",
  "delete-form" = "/node/{node}/delete",
  "collection" = "/admin/content",
},
```

Note, this is not taken verbatim from the Node module, it is only an example.

Creating these links does not automatically create the routes for those URIs. To make these links accessible, your module will need to implement its own routing.yml file, or use a "route_provider" handler in the entity annotation.

### Links & Route Provider

The above links working together with a "route_provider" will make the following named routes available to Drupal.  
 

|Links Key|Route Name|Route Example URI|Description|
|---|---|---|---|
|canonical|entity.node.canonical|/node/1|View a specific node|
|add-page|entity.node.add_page|/node/add|Select bundle of node to be added|
|add-form|entity.node.add_form|/node/add/article|Add a node (of a specific bundle)|
|edit-form|entity.node.edit_form|/node/1/edit|Edit form for a specific node|
|delete-form|entity.node.delete_form|/node/1/delete|Delete form for a specific node|
|collection|entity.node.collection|/admin/content|View all nodes as a list|

#### Using Links

These links can be accessed with an entity's toUrl() method:

```php
$view_url_object = $entity->toUrl();  // Default is 'canonical'
$edit_url_string = $entity->toUrl('edit-form')->toString();
```


---
---
Describes how to define and manipulate content and configuration entities.

Entities, in Drupal, are objects that are used for persistent storage of content and configuration information. See the Information types topic for an overview of the different types of information, and the Configuration API topic for more about the configuration API.

Each entity is an instance of a particular "entity type". Some content entity types have sub-types, which are known as "bundles", while for other entity types, there is only a single bundle. For example, the Node content entity type, which is used for the main content pages in Drupal, has bundles that are known as "content types", while the User content type, which is used for user accounts, has only one bundle.

The sections below have more information about entities and the Entity API; for more detailed information, see https://www.drupal.org/developing/api/entity .

### Defining an entity type

Entity types are defined by modules, using Drupal's Plugin API (see the Plugin API topic for more information about plugins in general). Here are the steps to follow to define a new entity type:

- Choose a unique machine name, or ID, for your entity type. This normally starts with (or is the same as) your module's machine name. It should be as short as possible, and may not exceed 32 characters.
- Define an interface for your entity's get/set methods, usually extending either [\Drupal\Core\Config\Entity\ConfigEntityInterface](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Config%21Entity%21ConfigEntityInterface.php/interface/ConfigEntityInterface/10 "Defines a common interface for configuration entities.") or [\Drupal\Core\Entity\ContentEntityInterface](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21ContentEntityInterface.php/interface/ContentEntityInterface/10 "Defines a common interface for all content entity objects."). Other interfaces that add functionality are also available: see the Entity characteristics topic for more information.
- Define a class for your entity, implementing your interface and extending either [\Drupal\Core\Config\Entity\ConfigEntityBase](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Config%21Entity%21ConfigEntityBase.php/class/ConfigEntityBase/10) or [\Drupal\Core\Entity\ContentEntityBase](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21ContentEntityBase.php/class/ContentEntityBase/10 "Implements Entity Field API specific enhancements to the Entity class."), with annotation for @ConfigEntityType or @ContentEntityType in its documentation block. If you are defining a content entity type, it is recommended to extend the [\Drupal\Core\Entity\EditorialContentEntityBase](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21EditorialContentEntityBase.php/class/EditorialContentEntityBase/10 "Provides a base entity class with extended revision and publishing support.") base class in order to get out-of-the-box support for Entity API's revisioning and publishing features, which will allow your entity type to be used with Drupal's editorial workflow provided by the Content Moderation module.
- In the annotation, the 'id' property gives the entity type ID, and the 'label' property gives the human-readable name of the entity type. If you are defining a content entity type that uses bundles, the 'bundle_label' property gives the human-readable name to use for a bundle of this entity type (for example, "Content type" for the Node entity).
- The annotation will refer to several handler classes, which you will also need to define:
    
    - **list_builder**: Define a class that extends [\Drupal\Core\Config\Entity\ConfigEntityListBuilder](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Config%21Entity%21ConfigEntityListBuilder.php/class/ConfigEntityListBuilder/10 "Defines the default class to build a listing of configuration entities.") (for configuration entities) or [\Drupal\Core\Entity\EntityListBuilder](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21EntityListBuilder.php/class/EntityListBuilder/10 "Defines a generic implementation to build a listing of entities.") (for content entities), to provide an administrative overview for your entities.
    - **add and edit forms, or default form**: Define a class (or two) that extend(s) [\Drupal\Core\Entity\EntityForm](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21EntityForm.php/class/EntityForm/10 "Base class for entity forms.") to provide add and edit forms for your entities. For content entities, base class [\Drupal\Core\Entity\ContentEntityForm](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21ContentEntityForm.php/class/ContentEntityForm/10 "Entity form variant for content entity types.") is a better starting point.
    - **delete form**: Define a class that extends [\Drupal\Core\Entity\EntityConfirmFormBase](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21EntityConfirmFormBase.php/class/EntityConfirmFormBase/10 "Provides a generic base class for an entity-based confirmation form.") to provide a delete confirmation form for your entities.
    - **view_builder**: For content entities and config entities that need to be viewed, define a class that implements [\Drupal\Core\Entity\EntityViewBuilderInterface](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21EntityViewBuilderInterface.php/interface/EntityViewBuilderInterface/10 "Defines an interface for entity view builders.") (usually extending [\Drupal\Core\Entity\EntityViewBuilder](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21EntityViewBuilder.php/class/EntityViewBuilder/10 "Base class for entity view builders.")), to display a single entity.
    - **translation**: For translatable content entities (if the 'translatable' annotation property has value TRUE), define a class that extends [\Drupal\content_translation\ContentTranslationHandler](https://api.drupal.org/api/drupal/core%21modules%21content_translation%21src%21ContentTranslationHandler.php/class/ContentTranslationHandler/10 "Base class for content translation handlers."), to translate the content. Configuration translation is handled automatically by the Configuration Translation module, without the need of a handler class.
    - **access**: If your configuration entity has complex permissions, you might need an access control handling, implementing [\Drupal\Core\Entity\EntityAccessControlHandlerInterface](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21EntityAccessControlHandlerInterface.php/interface/EntityAccessControlHandlerInterface/10 "Defines an interface for entity access control handlers."), but most entities can just use the 'admin_permission' annotation property instead. Note that if you are creating your own access control handler, you should override the checkAccess() and checkCreateAccess() methods, not access().
    - **storage**: A class implementing [\Drupal\Core\Entity\EntityStorageInterface](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21EntityStorageInterface.php/interface/EntityStorageInterface/10 "Defines the interface for entity storage classes."). If not specified, content entities will use [\Drupal\Core\Entity\Sql\SqlContentEntityStorage](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21Sql%21SqlContentEntityStorage.php/class/SqlContentEntityStorage/10 "A content entity database storage implementation."), and config entities will use [\Drupal\Core\Config\Entity\ConfigEntityStorage](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Config%21Entity%21ConfigEntityStorage.php/class/ConfigEntityStorage/10 "Defines the storage class for configuration entities."). You can extend one of these classes to provide custom behavior.
    - **views_data**: A class implementing [\Drupal\views\EntityViewsDataInterface](https://api.drupal.org/api/drupal/core%21modules%21views%21src%21EntityViewsDataInterface.php/interface/EntityViewsDataInterface/10 "Provides an interface to integrate an entity type with views.") to provide views data for the entity type. You can autogenerate most of the views data by extending [\Drupal\views\EntityViewsData](https://api.drupal.org/api/drupal/core%21modules%21views%21src%21EntityViewsData.php/class/EntityViewsData/10 "Provides generic views integration for entities.").
- For content entities, the annotation will refer to a number of database tables and their fields. These annotation properties, such as 'base_table', 'data_table', 'entity_keys', etc., are documented on [\Drupal\Core\Entity\EntityType](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21EntityType.php/class/EntityType/10 "Provides an implementation of an entity type and its metadata.").
- For content entities that are displayed on their own pages, the annotation will refer to a 'uri_callback' function, which takes an object of the entity interface you have defined as its parameter, and returns routing information for the entity page; see node_uri() for an example. You will also need to add a corresponding route to your module's routing.yml file; see the entity.node.canonical route in [node.routing.yml](https://api.drupal.org/api/drupal/core%21modules%21node%21node.routing.yml/10 "core/modules/node/node.routing.yml") for an example, and see [Entity routes](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21entity.api.php/group/entity_api/#sec_routes) below for some notes.
- Optionally, instead of defining routes, routes can be auto generated by providing a route handler. See [Entity routes](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21entity.api.php/group/entity_api/#sec_routes). Otherwise, define routes and links for the various URLs associated with the entity. These go into the 'links' annotation, with the link type as the key, and the path of this link template as the value. The corresponding route requires the following route name: "entity.$entity_type_id.$link_template_type". See [Entity routes](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21entity.api.php/group/entity_api/#sec_routes) below for some routing notes. Typical link types are:
    
    - **canonical**: Default link, either to view (if entities are viewed on their own pages) or edit the entity.
    - **delete-form**: Confirmation form to delete the entity.
    - **edit-form**: Editing form.
    - Other link types specific to your entity type can also be defined.
- If your content entity is fieldable, provide the 'field_ui_base_route' annotation property, giving the name of the route that the Manage Fields, Manage Display, and Manage Form Display pages from the Field UI module will be attached to. This is usually the bundle settings edit page, or an entity type settings page if there are no bundles.
- If your content entity has bundles, you will also need to define a second plugin to handle the bundles. This plugin is itself a configuration entity type, so follow the steps here to define it. The machine name ('id' annotation property) of this configuration entity class goes into the 'bundle_entity_type' annotation property on the entity type class. For example, for the Node entity, the bundle class is [\Drupal\node\Entity\NodeType](https://api.drupal.org/api/drupal/core%21modules%21node%21src%21Entity%21NodeType.php/class/NodeType/10 "Defines the Node type configuration entity."), whose machine name is 'node_type'. This is the annotation property 'bundle_entity_type' on the [\Drupal\node\Entity\Node](https://api.drupal.org/api/drupal/core%21modules%21node%21src%21Entity%21Node.php/class/Node/10 "Defines the node entity class.") class. Also, the bundle config entity type annotation must have a 'bundle_of' property, giving the machine name of the entity type it is acting as a bundle for. These machine names are considered permanent, they may not be renamed.
- Additional annotation properties can be seen on entity class examples such as [\Drupal\node\Entity\Node](https://api.drupal.org/api/drupal/core%21modules%21node%21src%21Entity%21Node.php/class/Node/10 "Defines the node entity class.") (content) and [\Drupal\user\Entity\Role](https://api.drupal.org/api/drupal/core%21modules%21user%21src%21Entity%21Role.php/class/Role/10 "Defines the user role entity class.") (configuration). These annotation properties are documented on [\Drupal\Core\Entity\EntityType](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21EntityType.php/class/EntityType/10 "Provides an implementation of an entity type and its metadata.").

### Entity routes

Entity routes can be defined in *.routing.yml files, like any other route: see the [Routing API](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Routing%21routing.api.php/group/routing/10 "Route page requests to code based on URLs.") topic for more information. Another option for entity routes is to use a route provider class, and reference it in the annotations on the entity class: see the end of this section for an example.

It's possible to use both a YAML file and a provider class for entity routes, at the same time. Avoid duplicating route names between the two: if a duplicate route name is found in both locations, the one in the YAML file takes precedence; regardless, such duplication can be confusing.

Here's an example YAML route specification, for the block configure form:

```yml

entity.block.edit_form:
  path: '/admin/structure/block/manage/{block}'
  defaults:
    _entity_form: 'block.default'
    _title: 'Configure block'
  requirements:
    _entity_access: 'block.update'
```

Some notes on this example:

- **path**: The {block} in the path is a placeholder, which (for an entity) must always take the form of {machine_name_of_entity_type}. In the URL, the placeholder value will be the ID of an entity item. When the route is used, the entity system will load the corresponding entity item and pass it in as an object to the controller for the route.
- **defaults**: For entity form routes, use _entity_form rather than the generic _controller or _form. The value is composed of the entity type machine name and a form handler type from the entity annotation (see [Defining an entity type](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21entity.api.php/group/entity_api/#define) above for more on handlers and annotation). So, in this example, block.default refers to the 'default' form handler on the block entity type, whose annotation contains:

```php

  handlers = {
    "form" = {
      "default" = "Drupal\block\BlockForm",
  
```

If instead of YAML you want to use a route provider class:

- [\Drupal\Core\Entity\Routing\DefaultHtmlRouteProvider](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21Routing%21DefaultHtmlRouteProvider.php/class/DefaultHtmlRouteProvider/10 "Provides HTML routes for entities.") provides canonical, edit-form, and delete-form routes.
- [\Drupal\Core\Entity\Routing\AdminHtmlRouteProvider](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21Routing%21AdminHtmlRouteProvider.php/class/AdminHtmlRouteProvider/10 "Provides HTML routes for entities with administrative add/edit/delete pages.") provides the same routes, set up to use the administrative theme for edit and delete pages.
- You can also create your own class, extending one of these two classes if you only want to modify their behavior slightly.

To register any route provider class, add lines like the following to your entity class annotation:

```php

handlers = {
  "route_provider" = {
    "html" = "Drupal\Core\Entity\Routing\DefaultHtmlRouteProvider",
```

### Defining a content entity bundle

For entity types that use bundles, such as Node (bundles are content types) and Taxonomy (bundles are vocabularies), modules and install profiles can define bundles by supplying default configuration in their config/install directories. (See the [Configuration API topic](https://api.drupal.org/api/drupal/core%21core.api.php/group/config_api/10 "Information about the Configuration API.") for general information about configuration.)

There are several good examples of this in Drupal Core:

- The Forum module defines a content type in [node.type.forum.yml](https://api.drupal.org/api/drupal/core%21modules%21forum%21config%21optional%21node.type.forum.yml/10 "core/modules/forum/config/optional/node.type.forum.yml") and a vocabulary in [taxonomy.vocabulary.forums.yml](https://api.drupal.org/api/drupal/core%21modules%21forum%21config%21optional%21taxonomy.vocabulary.forums.yml/10 "core/modules/forum/config/optional/taxonomy.vocabulary.forums.yml")
- The Book module defines a content type in [node.type.book.yml](https://api.drupal.org/api/drupal/core%21modules%21book%21config%21optional%21node.type.book.yml/10 "core/modules/book/config/optional/node.type.book.yml")
- The Standard install profile defines Page and Article content types in [node.type.page.yml](https://api.drupal.org/api/drupal/10/search/node.type.page.yml "Multiple implementations exist.") and [node.type.article.yml](https://api.drupal.org/api/drupal/10/search/node.type.article.yml "Multiple implementations exist."), a Tags vocabulary in [taxonomy.vocabulary.tags.yml](https://api.drupal.org/api/drupal/10/search/taxonomy.vocabulary.tags.yml "Multiple implementations exist."), and a Node comment type in [comment.type.comment.yml](https://api.drupal.org/api/drupal/10/search/comment.type.comment.yml "Multiple implementations exist."). This profile's configuration is especially instructive, because it also adds several fields to the Article type, and it sets up view and form display modes for the node types.

### Loading, querying, and rendering entities

To load entities, use the entity storage manager, which is an object implementing [\Drupal\Core\Entity\EntityStorageInterface](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21EntityStorageInterface.php/interface/EntityStorageInterface/10 "Defines the interface for entity storage classes.") that you can retrieve with:

```php
$storage = \Drupal::entityTypeManager()
  ->getStorage('your_entity_type');

// Or if you have a $container variable:
$storage = $container
  ->get('entity_type.manager')
  ->getStorage('your_entity_type');
```

Here, 'your_entity_type' is the machine name of your entity type ('id' annotation property on the entity class), and note that you should use dependency injection to retrieve this object if possible. See the [Services and Dependency Injection topic](https://api.drupal.org/api/drupal/core%21core.api.php/group/container/10 "Overview of the Dependency Injection Container and Services.") for more about how to properly retrieve services.

To query to find entities to load, use an entity query, which is an object implementing [\Drupal\Core\Entity\Query\QueryInterface](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21Query%21QueryInterface.php/interface/QueryInterface/10 "Interface for entity queries.") that you can retrieve with:

```php
// Simple query:
$query = \Drupal::entityQuery('your_entity_type');

// Or, if you have a $container variable:
$storage = $container
  ->get('entity_type.manager')
  ->getStorage('your_entity_type');
$query = $storage
  ->getQuery();
```

If you need aggregation, there is an aggregate query available, which implements [\Drupal\Core\Entity\Query\QueryAggregateInterface](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21Query%21QueryAggregateInterface.php/interface/QueryAggregateInterface/10 "Defines an interface for aggregated entity queries."):

```php

$query \Drupal::entityQueryAggregate('your_entity_type');
// Or:
$query = $storage->getAggregateQuery('your_entity_type');
```

In either case, you can then add conditions to your query, using methods like condition(), exists(), etc. on $query; add sorting, pager, and range if needed, and execute the query to return a list of entity IDs that match the query.

Here is an example, using the core File entity:

```php
$fids = Drupal::entityQuery('file')
  ->condition('status', \Drupal\file\FileInterface::STATUS_PERMANENT, '<>')
  ->condition('changed', REQUEST_TIME - $age, '<')
  ->range(0, 100)
  ->execute();
$files = $storage
  ->loadMultiple($fids);
```

The normal way of viewing entities is by using a route, as described in the sections above. If for some reason you need to render an entity in code in a particular view mode, you can use an entity view builder, which is an object implementing [\Drupal\Core\Entity\EntityViewBuilderInterface](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21EntityViewBuilderInterface.php/interface/EntityViewBuilderInterface/10 "Defines an interface for entity view builders.") that you can retrieve with:

```php
$view_builder = \Drupal::entityTypeManager()
  ->getViewBuilder('your_entity_type');

// Or if you have a $container variable:
$view_builder = $container
  ->get('entity_type.manager')
  ->getViewBuilder('your_entity_type');
```

Then, to build and render the entity:

```php
// You can omit the language ID, by default the current content language will
// be used. If no translation is available for the current language, fallback
// rules will be used.
$build = $view_builder
  ->view($entity, 'view_mode_name', $language
  ->getId());

// $build is a render array.
$rendered = \Drupal::service('renderer')
  ->render($build);
```

### Access checking on entities

Entity types define their access permission scheme in their annotation. Access permissions can be quite complex, so you should not assume any particular permission scheme. Instead, once you have an entity object loaded, you can check for permission for a particular operation (such as 'view') at the entity or field level by calling:

```php
$entity
  ->access($operation);
$entity->nameOfField
  ->access($operation);
```

The interface related to access checking in entities and fields is [\Drupal\Core\Access\AccessibleInterface](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Access%21AccessibleInterface.php/interface/AccessibleInterface/10 "Interface for checking access.").

The default entity access control handler invokes two hooks while checking access on a single entity: [hook_entity_access](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21entity.api.php/function/hook_entity_access/10 "Control entity operation access.")() is invoked first, and then [hook_ENTITY_TYPE_access](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21entity.api.php/function/hook_ENTITY_TYPE_access/10 "Control entity operation access for a specific entity type.")() (where ENTITY_TYPE is the machine name of the entity type). If no module returns a TRUE or FALSE value from either of these hooks, then the entity's default access checking takes place. For create operations (creating a new entity), the hooks that are invoked are [hook_entity_create_access](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21entity.api.php/function/hook_entity_create_access/10 "Control entity create access.")() and [hook_ENTITY_TYPE_create_access](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21entity.api.php/function/hook_ENTITY_TYPE_create_access/10 "Control entity create access for a specific entity type.")() instead.

The access to an entity can be influenced in several ways:

- To explicitly allow access, return an AccessResultInterface object with

isAllowed() returning TRUE. Other modules can override this access by returning TRUE for isForbidden().

- To explicitly forbid access, return an AccessResultInterface object with

isForbidden() returning TRUE. Access will be forbidden even if your module (or another module) also returns TRUE for isNeutral() or isAllowed().

- To neither allow nor explicitly forbid access, return an

AccessResultInterface object with isNeutral() returning TRUE.

- If your module does not return an AccessResultInterface object, neutral

access will be assumed.

The Node entity type has a complex system for determining access, which developers can interact with. This is described in the [Node access topic.](https://api.drupal.org/api/drupal/core%21modules%21node%21node.module/group/node_access/10 "The node access system determines who can do what to which nodes.")

### See also

[Internationalization](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Language%21language.api.php/group/i18n/10 "Internationalization and translation")

[Entity CRUD, editing, and view hooks](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21entity.api.php/group/entity_crud/10 "Hooks used in various entity operations.")

[\Drupal\Core\Entity\EntityRepositoryInterface::getTranslationFromContext](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21EntityRepositoryInterface.php/function/EntityRepositoryInterface%3A%3AgetTranslationFromContext/10 "Gets the entity translation to be used in the given context.")()

### File

core/lib/Drupal/Core/Entity/[entity.api.php](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21entity.api.php/10), line 331

Hooks and documentation related to entities.

### Functions

|[Name![sort descending](https://api.drupal.org/misc/arrow-desc.png "sort descending")](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21entity.api.php/group/entity_api?order=title&sort=desc "sort by Name")|[Location](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21entity.api.php/group/entity_api?order=file_name&sort=asc "sort by Location")|Description|
|---|---|---|
|[hook_entity_access](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21entity.api.php/function/hook_entity_access/10)|core/lib/Drupal/Core/Entity/[entity.api.php](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21entity.api.php/10)|Control entity operation access.|
|[hook_entity_create_access](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21entity.api.php/function/hook_entity_create_access/10)|core/lib/Drupal/Core/Entity/[entity.api.php](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21entity.api.php/10)|Control entity create access.|
|[hook_ENTITY_TYPE_access](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21entity.api.php/function/hook_ENTITY_TYPE_access/10)|core/lib/Drupal/Core/Entity/[entity.api.php](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21entity.api.php/10)|Control entity operation access for a specific entity type.|
|[hook_ENTITY_TYPE_create_access](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21entity.api.php/function/hook_ENTITY_TYPE_create_access/10)|core/lib/Drupal/Core/Entity/[entity.api.php](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21entity.api.php/10)|Control entity create access for a specific entity type.|

### Classes

|[Name![sort descending](https://api.drupal.org/misc/arrow-desc.png "sort descending")](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21entity.api.php/group/entity_api?order=title&sort=desc "sort by Name")|[Location](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21entity.api.php/group/entity_api?order=file_name&sort=asc "sort by Location")|Description|
|---|---|---|
|[ConfigEntityListBuilder](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Config%21Entity%21ConfigEntityListBuilder.php/class/ConfigEntityListBuilder/10)|core/lib/Drupal/Core/Config/Entity/[ConfigEntityListBuilder.php](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Config%21Entity%21ConfigEntityListBuilder.php/10)|Defines the default class to build a listing of configuration entities.|
|[ConfigEntityStorage](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Config%21Entity%21ConfigEntityStorage.php/class/ConfigEntityStorage/10)|core/lib/Drupal/Core/Config/Entity/[ConfigEntityStorage.php](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Config%21Entity%21ConfigEntityStorage.php/10)|Defines the storage class for configuration entities.|
|[ConfigEntityType](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21Annotation%21ConfigEntityType.php/class/ConfigEntityType/10)|core/lib/Drupal/Core/Entity/Annotation/[ConfigEntityType.php](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21Annotation%21ConfigEntityType.php/10)|Defines a config entity type annotation object.|
|[ContentEntityBase](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21ContentEntityBase.php/class/ContentEntityBase/10)|core/lib/Drupal/Core/Entity/[ContentEntityBase.php](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21ContentEntityBase.php/10)|Implements Entity Field API specific enhancements to the Entity class.|
|[ContentEntityType](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21Annotation%21ContentEntityType.php/class/ContentEntityType/10)|core/lib/Drupal/Core/Entity/Annotation/[ContentEntityType.php](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21Annotation%21ContentEntityType.php/10)|Defines a content entity type annotation object.|
|[ContentTranslationHandler](https://api.drupal.org/api/drupal/core%21modules%21content_translation%21src%21ContentTranslationHandler.php/class/ContentTranslationHandler/10)|core/modules/content_translation/src/[ContentTranslationHandler.php](https://api.drupal.org/api/drupal/core%21modules%21content_translation%21src%21ContentTranslationHandler.php/10)|Base class for content translation handlers.|
|[EditorialContentEntityBase](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21EditorialContentEntityBase.php/class/EditorialContentEntityBase/10)|core/lib/Drupal/Core/Entity/[EditorialContentEntityBase.php](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21EditorialContentEntityBase.php/10)|Provides a base entity class with extended revision and publishing support.|
|[EntityConfirmFormBase](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21EntityConfirmFormBase.php/class/EntityConfirmFormBase/10)|core/lib/Drupal/Core/Entity/[EntityConfirmFormBase.php](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21EntityConfirmFormBase.php/10)|Provides a generic base class for an entity-based confirmation form.|
|[EntityDeleteForm](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21EntityDeleteForm.php/class/EntityDeleteForm/10)|core/lib/Drupal/Core/Entity/[EntityDeleteForm.php](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21EntityDeleteForm.php/10)|Provides a generic base class for an entity deletion form.|
|[EntityForm](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21EntityForm.php/class/EntityForm/10)|core/lib/Drupal/Core/Entity/[EntityForm.php](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21EntityForm.php/10)|Base class for entity forms.|
|[EntityHandlerBase](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21EntityHandlerBase.php/class/EntityHandlerBase/10)|core/lib/Drupal/Core/Entity/[EntityHandlerBase.php](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21EntityHandlerBase.php/10)|Provides a base class for entity handlers.|
|[EntityListBuilder](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21EntityListBuilder.php/class/EntityListBuilder/10)|core/lib/Drupal/Core/Entity/[EntityListBuilder.php](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21EntityListBuilder.php/10)|Defines a generic implementation to build a listing of entities.|
|[EntityType](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21Annotation%21EntityType.php/class/EntityType/10)|core/lib/Drupal/Core/Entity/Annotation/[EntityType.php](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21Annotation%21EntityType.php/10)|Defines an Entity type annotation object.|
|[EntityType](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21EntityType.php/class/EntityType/10)|core/lib/Drupal/Core/Entity/[EntityType.php](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21EntityType.php/10)|Provides an implementation of an entity type and its metadata.|
|[EntityViewBuilder](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21EntityViewBuilder.php/class/EntityViewBuilder/10)|core/lib/Drupal/Core/Entity/[EntityViewBuilder.php](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21EntityViewBuilder.php/10)|Base class for entity view builders.|
|[RevisionableContentEntityBase](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21RevisionableContentEntityBase.php/class/RevisionableContentEntityBase/10)|core/lib/Drupal/Core/Entity/[RevisionableContentEntityBase.php](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21RevisionableContentEntityBase.php/10)|Provides a content entity with extended support for revisions.|
|[SqlContentEntityStorage](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21Sql%21SqlContentEntityStorage.php/class/SqlContentEntityStorage/10)|core/lib/Drupal/Core/Entity/Sql/[SqlContentEntityStorage.php](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21Sql%21SqlContentEntityStorage.php/10)|A content entity database storage implementation.|

### Interfaces

|[Name![sort descending](https://api.drupal.org/misc/arrow-desc.png "sort descending")](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21entity.api.php/group/entity_api?order=title&sort=desc "sort by Name")|[Location](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21entity.api.php/group/entity_api?order=file_name&sort=asc "sort by Location")|Description|
|---|---|---|
|[AccessibleInterface](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Access%21AccessibleInterface.php/interface/AccessibleInterface/10)|core/lib/Drupal/Core/Access/[AccessibleInterface.php](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Access%21AccessibleInterface.php/10)|Interface for checking access.|
|[ConfigEntityInterface](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Config%21Entity%21ConfigEntityInterface.php/interface/ConfigEntityInterface/10)|core/lib/Drupal/Core/Config/Entity/[ConfigEntityInterface.php](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Config%21Entity%21ConfigEntityInterface.php/10)|Defines a common interface for configuration entities.|
|[ContentEntityInterface](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21ContentEntityInterface.php/interface/ContentEntityInterface/10)|core/lib/Drupal/Core/Entity/[ContentEntityInterface.php](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21ContentEntityInterface.php/10)|Defines a common interface for all content entity objects.|
|[EntityHandlerInterface](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21EntityHandlerInterface.php/interface/EntityHandlerInterface/10)|core/lib/Drupal/Core/Entity/[EntityHandlerInterface.php](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21EntityHandlerInterface.php/10)|Defines an interface for entity handlers.|
|[EntityInterface](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21EntityInterface.php/interface/EntityInterface/10)|core/lib/Drupal/Core/Entity/[EntityInterface.php](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21EntityInterface.php/10)|Defines a common interface for all entity objects.|
|[EntityStorageInterface](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21EntityStorageInterface.php/interface/EntityStorageInterface/10)|core/lib/Drupal/Core/Entity/[EntityStorageInterface.php](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21EntityStorageInterface.php/10)|Defines the interface for entity storage classes.|
|[EntityViewBuilderInterface](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21EntityViewBuilderInterface.php/interface/EntityViewBuilderInterface/10)|core/lib/Drupal/Core/Entity/[EntityViewBuilderInterface.php](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21EntityViewBuilderInterface.php/10)|Defines an interface for entity view builders.|
|[FieldableEntityInterface](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21FieldableEntityInterface.php/interface/FieldableEntityInterface/10)|core/lib/Drupal/Core/Entity/[FieldableEntityInterface.php](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21FieldableEntityInterface.php/10)|Interface for entities having fields.|

### Traits

|[Name![sort descending](https://api.drupal.org/misc/arrow-desc.png "sort descending")](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21entity.api.php/group/entity_api?order=title&sort=desc "sort by Name")|[Location](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21entity.api.php/group/entity_api?order=file_name&sort=asc "sort by Location")|Description|
|---|---|---|
|[EntityDeleteFormTrait](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21EntityDeleteFormTrait.php/trait/EntityDeleteFormTrait/10)|core/lib/Drupal/Core/Entity/[EntityDeleteFormTrait.php](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21EntityDeleteFormTrait.php/10)|Provides a trait for an entity deletion form.|
|[RevisionLogEntityTrait](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21RevisionLogEntityTrait.php/trait/RevisionLogEntityTrait/10)|core/lib/Drupal/Core/Entity/[RevisionLogEntityTrait.php](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21RevisionLogEntityTrait.php/10)|Provides a trait for accessing revision logging and ownership information.|
|[SynchronizableEntityTrait](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21SynchronizableEntityTrait.php/trait/SynchronizableEntityTrait/10)|core/lib/Drupal/Core/Entity/[SynchronizableEntityTrait.php](https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21SynchronizableEntityTrait.php/10)|Provides a trait for accessing synchronization information.|

