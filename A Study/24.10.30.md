###  session 的存储位置和 `session_start()` 的工作原理

Session 存储位置：
1. 服务器端存储：
   - 默认情况下，PHP 将 session 数据存储在服务器上。
   - 存储位置通常是服务器的文件系统，具体路径由 PHP 配置决定（通常在 /tmp 或类似目录）。
   - 每个 session 通常对应一个文件，文件名基于 session ID。
2. 数据库存储：3. 缓存系统：4. 客户端存储：

当执行 `session_start()` 时发生的事情：
1. ==检查现有 Session==：
   - PHP 首先检查是否有来自客户端的 session ID（通常在 cookie 中）。
2. ==如果找到现有 Session ID==：
   - 尝试在服务器上找到对应的 session 数据。
   - 如果找到，加载这些数据到 `$_SESSION` 超全局变量中。
3. 如果没有找到现有 Session ID 或数据：
   - 生成一个新的 session ID。
   - 在服务器上创建一个新的 session 存储空间。
   - 发送一个包含新 session ID 的 cookie 到客户端。
4. 初始化 Session：
   - 设置必要的 HTTP 头（如设置 cookie）。
   - 准备 `$_SESSION` 数组以供使用。
5. 锁定 Session：
   - 为防止并发访问问题，session 文件通常会被锁定。
6. 开始使用：
   - 此时，您可以开始读取或写入 `$_SESSION` 数组。
7. 性能影响：
   - 启动 session 会占用一些服务器资源。
   - 它还可能阻塞同一用户的并发请求（因为 session 锁定）。
### `$_SESSION` 数组确实是一个关键概念， `$_SESSION` 如何在多用户环境中工作：

1. `$_SESSION` 的本质：
   - `$_SESSION` 是 PHP 中的一个超全局变量。
   - 它是一个数组，用于存储特定用户会话的数据。
2. 每个用户的==独立== `$_SESSION`：
   - 尽管代码中只看到一个 `$_SESSION`，但实际上每个用户都有自己独立的 `$_SESSION` 数组。
   - PHP 为每个会话维护一个单独的 `$_SESSION` 实例。

3. 会话 ID 的作用：
   - 每个用户都有==唯一的会话 ID==。
   - 这个 ID 用于将用户与其特定的 `$_SESSION` 数据关联起来。

4. 工作流程：
   - 当用户发送请求时，会发送他们的会话 ID（通常通过 cookie）。
   - PHP 使用这个 ID 来检索正确的会话数据。
   - 检索到的数据被加载到 `$_SESSION` 中。
   - 脚本可以读取和修改 `$_SESSION`。
   - 请求结束时，`$_SESSION` 的内容被保存回服务器存储。

5. 隔离性：
   - 用户 A 的 `$_SESSION` 数据对用户 B 是完全不可见的。
   - 每个请求只能访问属于当前用户的 `$_SESSION` 数据。

总结：
`$_SESSION` 看似是一个全局变量，但实际上为每个用户维护了一个独立的实例。PHP 和 Web 服务器协同工作，确保每个用户只能访问和修改自己的会话数据。这种机制允许在共享的服务器环境中为每个用户维护私有和安全的状态信息。

### 用户 Session 数量

1. 理想情况下：
   - 是的，一个==用户通常应该只有一个活动的 session==。
   - 这是大多数 Web 应用程序的设计目标。
2. 实际情况：
   - 在某些情况下，一个用户可能会有多个 session。
3. ==多个 session 的情况==：
   a. 多设备登录：
      - 用户在不同设备（如手机和电脑）上同时登录。
      - 某些应用允许这种情况，每个设备有独立的 session。
   b. 多浏览器：
      - 用户在同一设备的不同浏览器中登录。
      - 每个浏览器通常会维护独立的 session。
   c. 隐私模式：
   d. 应用程序设计：
      - 某些应用可能故意为不同的功能区域创建不同的 session。
   e. Session 超时和重新创建：
      - 如果旧 session 超时但用户仍在活动，可能会创建新 session。

4. Drupal 中的处理：
   - Drupal 通常尝试维护每个用户一个 session。
   - 但它==也支持多设备登录==，每个设备可能有独立的 session。

5. 安全考虑：
   - 允许多个 session 可能增加安全风险。
   - 一些应用实施 "单一会话" 策略，强制在新设备登录时终止旧 session。

6. Session 管理策略：
   - 一些应用提供 "查看活动会话" 和 "结束其他会话" 的功能。
   - 这允许用户管理他们的多个 session。

7. 技术实现：
   - 服务器==通常使用 session ID 来识别 session==，而不是直接使用用户 ID。
   - 这意味着==技术上可以==为同一用户创建多个 session。
